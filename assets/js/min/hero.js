function Building(i,t,e,s,h,o,a,l,n,p){this.map=i,this.life=o,this.name=a,this.x=t,this.y=e,this.col=h,this.row=s,this.hourstart=l,this.batiment=n,this.caracteristique=p,this.xDelta=0,this.yDelta=0,this.cible=0,this.cibleMouvante=0,this.calculPortee=function(i,t,e,s,h){xLimiteMoins=i-e,xLimitePlus=i+e,yLimiteMoins=t-e,yLimitePlus=t+e,xLimiteMoins<0&&(xLimiteMoins=0),yLimiteMoins<0&&(yLimiteMoins=0);for(var o=[i],a=[t],l=1;l<=e;l++)o.push(i-l),o.push(i+l),a.push(t-l),a.push(t+l);return!(!o.includes(s)||!a.includes(h))}}function Hero(i,t,e,s,h,o,a,l,n,p,m,u){this.map=i,this.x=t,this.y=e,this.life=s,this.xp=m,this.width=i.tsize,this.height=i.tsize,this.attaque=h,this.defense=o,this.equipement=u,this.supply={ecu:a,bois:l,argile:n,ble:p},this.image=Loader.getImage("hero"),this.addBuild=function(i,t,e,s,h){var o=0,a=0;if(Keyboard.isDown(Keyboard.LEFT)?o=-1:Keyboard.isDown(Keyboard.RIGHT)?o=1:Keyboard.isDown(Keyboard.UP)?a=-1:Keyboard.isDown(Keyboard.DOWN)&&(a=1),0!=o||0!=a)return!1;if(pos=e.getRow(t)*e.rows+e.getCol(i),0==abs2[pos+1]&&1==abs1[pos+1]){Game.hero.x=32+64*e.getCol(i),abs2[pos+1]=s;var l="build-"+e.getRow(t)+"-"+parseInt(e.getCol(i)+1,10)+"-ing";Game.nameBuild=new Building(e,i+32,t,e.getCol(i)+1,e.getRow(t),60,l,"hourstart",s,h),builds[e.getCol(i)+1+"-"+e.getRow(t)]=Game.nameBuild,anim=new animation(e,i+32,t,"cloud")}},this.addCorn=function(i,t,e,s,h,o){if(this.hourstart=s,posCorn=e.getRow(t)*e.rows+e.getCol(i),0==abs2[posCorn]&&1==abs1[posCorn]&&Game.hero.supply.ecu>=0){abs2[posCorn]=o;var a="ble-"+e.getRow(t)+parseInt(e.getCol(i),10);Game.hero.supply.ecu=Game.hero.supply.ecu-150,document.getElementById("argent_value").innerHTML=Game.hero.supply.ecu;var l=[];l.showLife=10,Game.nameBuild=new Building(e,i,t,e.getCol(i),e.getRow(t),h,a,"hourstart",o,l),builds[e.getCol(i)+"-"+e.getRow(t)]=Game.nameBuild,anim=new animation(e,i,t,"cloud")}},this.creuse=function(i,t,e){var s=Game.getTool(),h=this.supply.ecu;pos=e.getRow(t)*e.rows+e.getCol(i);var o=e.getCol(i),a=e.getRow(t);0==abs2[pos]&&2!=abs1[pos]&&"pelle"==s?(abs1[pos]=2,abs2[pos]=0,this.supply.ecu=h+10,document.getElementById("argent_value").innerHTML=this.supply.ecu):2==abs1[pos]&&"pelle"==s?(this.supply.ecu=h+1,document.getElementById("argent_value").innerHTML=this.supply.ecu):8!=abs2[pos]&&9!=abs2[pos]||1!=abs1[pos]||"faux"!=s?10==abs2[pos]&&"faux"==s&&10==builds[o+"-"+a].batiment&&(builds[o+"-"+a].life=builds[o+"-"+a].life-1,0==builds[o+"-"+a].life?(delete builds[o+"-"+a],abs1[pos]=2,abs2[pos]=0):abs2[pos]=10,this.supply.ble=this.supply.ble+100,document.getElementById("ble_value").innerHTML=this.supply.ble):(abs1[pos]=2,abs2[pos]=0,this.supply.ecu=h+1,document.getElementById("argent_value").innerHTML=this.supply.ecu),this.supply.ecu>h&&(anim=new animation(e,i,t,"coin"))}}Hero.SPEED=256,Hero.prototype.move=function(i,t,e){this.x+=t*Hero.SPEED*i,this.y+=e*Hero.SPEED*i,this._collide(t,e),this._ennemy(t,e),this._loselifeTile(t,e);var s=this.map.cols*this.map.tsize,h=this.map.rows*this.map.tsize;this.x=Math.max(0,Math.min(this.x,s)),this.y=Math.max(0,Math.min(this.y,h))},Hero.prototype._loselifeTile=function(i,t){var e=this.x-this.width/2,s=this.x+this.width/2-1,h=this.y-this.height/2,o=this.y+this.height/2-1,a=this.map.isLoseWinLife(e,h)||this.map.isLoseWinLife(s,h)||this.map.isLoseWinLife(s,o)||this.map.isLoseWinLife(e,o);"life"==a&&this.life<60&&(this.life=this.life+.1),1==a&&this.life>0&&(this.life=this.life-.1)},Hero.prototype._collide=function(i,t){var e,s,h=this.x-this.width/2,o=this.x+this.width/2-1,a=this.y-this.height/2,l=this.y+this.height/2-1;(this.map.isSolidTileAtXY(h,a)||this.map.isSolidTileAtXY(o,a)||this.map.isSolidTileAtXY(o,l)||this.map.isSolidTileAtXY(h,l))&&(t>0?(e=this.map.getRow(l),this.y=-this.height/2+this.map.getY(e)):t<0?(e=this.map.getRow(a),this.y=this.height/2+this.map.getY(e+1)):i>0?(s=this.map.getCol(o),this.x=-this.width/2+this.map.getX(s)):i<0&&(s=this.map.getCol(h),this.x=this.width/2+this.map.getX(s+1)))},Hero.prototype._ennemy=function(i,t){var e,s,h=this.x-this.width/2,o=this.x+this.width/2-1,a=this.y-this.height/2,l=this.y+this.height/2-1,n=this.map.isEnnemyTileAtXY(h,a)||this.map.isEnnemyTileAtXY(o,a)||this.map.isEnnemyTileAtXY(o,l)||this.map.isEnnemyTileAtXY(h,l);if(n){if(t>0?(e=this.map.getRow(l),this.y=-this.height/2+this.map.getY(e)):t<0?(e=this.map.getRow(a),this.y=this.height/2+this.map.getY(e+1)):i>0?(s=this.map.getCol(o),this.x=-this.width/2+this.map.getX(s)):i<0&&(s=this.map.getCol(h),this.x=this.width/2+this.map.getX(s+1)),this.life>0){var p=n.attaque-this.defense;p<0&&(p=.1);var m=this.attaque-n.defense;m<0&&(m=.1),this.life=this.life-p;var u=Game.getTool();n.life>0&&"epee"==u&&(n.life=n.life-m)}}else Object.keys(monsters).forEach(function(i){monsters[i].life<60&&(monsters[i].life=monsters[i].life+monsters[i].regeneration)})};