function Camera(e,t,a){this.x=0,this.y=0,this.width=t,this.height=a,this.maxX=e.cols*e.tsize-t,this.maxY=e.rows*e.tsize-a}function objet(e,t,a,i){this.name=e,this.life=a,this.attaque=i,this.image=Loader.getImage(t)}function animation(e,t,a,i){this.map=e,this.x=t,this.y=a,this.image=Loader.getImage(i)}DUREE_ANIMATION=50,builds=[],monsters=[],supply=[],Camera.prototype.follow=function(e){this.following=e,e.screenX=0,e.screenY=0},Camera.prototype.update=function(){0!=this.following.life&&(this.following.screenX=this.width/2,this.following.screenY=this.height/2,this.x=this.following.x-this.width/2,this.y=this.following.y-this.height/2,this.x=Math.max(0,Math.min(this.x,this.maxX)),this.y=Math.max(0,Math.min(this.y,this.maxY)),(this.following.x<this.width/2||this.following.x>this.maxX+this.width/2)&&(this.following.screenX=this.following.x-this.x),(this.following.y<this.height/2||this.following.y>this.maxY+this.height/2)&&(this.following.screenY=this.following.y-this.y))},Game.load=function(){return[Loader.loadImage("tiles","assets/tiles_new.png"),Loader.loadImage("hero","assets/character.png"),Loader.loadImage("hero2","assets/character2.png"),Loader.loadImage("troll2","assets/troll2.png"),Loader.loadImage("troll3","assets/troll3.png"),Loader.loadImage("scorpion1","assets/scorpion1.png"),Loader.loadImage("scorpion2","assets/scorpion2.png"),Loader.loadImage("coin","assets/coin.png"),Loader.loadImage("cloud","assets/cloud.png"),Loader.loadImage("xp","assets/xp.png"),Loader.loadImage("ball","assets/ball.png")]},Game.init=function(){var e=new Time;e.startTime(1e3),Keyboard.listenForEvents([Keyboard.LEFT,Keyboard.RIGHT,Keyboard.UP,Keyboard.DOWN]),this.tileAtlas=Loader.getImage("tiles"),this.anim=0,this.animBref=0,this.hero=new Hero(map,160,160,60,15,200,0,0,0,0,0,"pelle"),generateTroll(64,64,1,1),generateTroll(192,192,3,3),generateMonstre(map,384,128,6,2,10,10,.2,1,"scorpion1","scorpion2",.5,-1,0),generateMonstre(map,576,192,9,3,10,10,.2,1,"scorpion1","scorpion2",2.5,0,1),this.camera=new Camera(map,1024,768),this.camera.follow(this.hero),document.getElementById("addBuild").addEventListener("click",function(){Game.hero.addBuild(Game.hero.x,Game.hero.y,map,6)},!1),document.getElementById("addCorn").addEventListener("click",function(){Game.hero.addCorn(Game.hero.x,Game.hero.y,map,"heure_plante",3,10)},!1),document.getElementById("creuse").addEventListener("click",function(){Game.hero.creuse(Game.hero.x,Game.hero.y,map)},!1),document.getElementById("speed0").addEventListener("click",function(){clearTimeout(e.timeOut)}),document.getElementById("speed1").addEventListener("click",function(){clearTimeout(e.timeOut),e.startTime(1e3)}),document.getElementById("speed2").addEventListener("click",function(){clearTimeout(e.timeOut),e.startTime(250)}),document.getElementById("speed3").addEventListener("click",function(){clearTimeout(e.timeOut),e.startTime(100)})},Game.update=function(e){var t=0,a=0;if(Keyboard.isDown(Keyboard.LEFT)?t=-1:Keyboard.isDown(Keyboard.RIGHT)?t=1:Keyboard.isDown(Keyboard.UP)?a=-1:Keyboard.isDown(Keyboard.DOWN)&&(a=1),this.hero.life<=0)return!1;this.hero.move(e,t,a),Object.keys(monsters).forEach(function(t){monsters[t].vitesse>0&&monsters[t].move(e,Game.hero.x,Game.hero.y)}),this.camera.update()},Game.getTool=function(){return document.querySelector('input[name="tools"]:checked').value},Game._drawLayer=function(e){var t=Math.floor(this.camera.x/map.tsize),a=t+this.camera.width/map.tsize,i=Math.floor(this.camera.y/map.tsize),s=i+this.camera.height/map.tsize,o=-this.camera.x+t*map.tsize,r=-this.camera.y+i*map.tsize;Game.anim++;for(var m=t;m<=a;m++)for(var n=i;n<=s;n++){var l=map.getTile(e,m,n);6==l?Game.anim>=DUREE_ANIMATION&&(abs2[n*map.rows+m]=7):7==l&&Game.anim>=DUREE_ANIMATION&&(abs2[n*map.rows+m]=6),8==l?Game.anim>=DUREE_ANIMATION&&(abs2[n*map.rows+m]=9):9==l&&Game.anim>=DUREE_ANIMATION&&(abs2[n*map.rows+m]=8);var c=(m-t)*map.tsize+o,d=(n-i)*map.tsize+r;0!==l&&this.ctx.drawImage(this.tileAtlas,(l-1)*map.tsize,0,map.tsize,map.tsize,Math.round(c),Math.round(d),map.tsize,map.tsize)}Object.keys(builds).forEach(function(e){1==builds[e].caracteristique.showLife&&Game._drawRectangle("#FFFFFF",builds[e].row*map.tsize-Math.round(Game.camera.x),builds[e].col*map.tsize-Math.round(Game.camera.y)+map.tsize+5,builds[e].life)}),Game.anim>=DUREE_ANIMATION/2?(Game.hero.image=Loader.getImage("hero2"),Object.keys(monsters).forEach(function(e){monsters[e].image=Loader.getImage(monsters[e].image1)})):(Game.hero.image=Loader.getImage("hero"),Object.keys(monsters).forEach(function(e){monsters[e].image=Loader.getImage(monsters[e].image2)})),"undefined"!=typeof anim&&null!==anim&&(Game.animBref<=DUREE_ANIMATION?(Game.ctx.drawImage(anim.image,0,0,map.tsize,map.tsize,anim.x-Game.camera.x,anim.y-Game.camera.y-Game.animBref,map.tsize,map.tsize),Game.animBref++,Game.animBref++):(anim=null,Game.animBref=0)),Object.keys(builds).forEach(function(e){6==builds[e].batiment&&Object.keys(monsters).forEach(function(t){if(!(monsters[t].row-2!=builds[e].row&&monsters[t].row-1!=builds[e].row&&monsters[t].row!=builds[e].row&&monsters[t].row+1!=builds[e].row&&monsters[t].row+2!=builds[e].row||monsters[t].col-2!=builds[e].col&&monsters[t].col-1!=builds[e].col&&monsters[t].col!=builds[e].col&&monsters[t].col+1!=builds[e].col&&monsters[t].col+2!=builds[e].col)&&(0==builds[e].cible&&(builds[e].cible=t,monsters[t].vitesse>0&&(builds[e].cibleMouvante=1)),builds[e].cible==t||1==builds[e].cibleMouvante&&monsters[t].vitesse>0))if(yFinal=monsters[t].y,xFinal=monsters[t].x+20,builds[e].x>monsters[t].x?xDistance=builds[e].x-xFinal:xDistance=xFinal-builds[e].x,builds[e].y>yFinal?yDistance=builds[e].y-yFinal:yDistance=yFinal-builds[e].y,builds[e].xDelta<=xDistance||builds[e].yDelta<=yDistance){if(builds[e].xDelta>=xDistance&&(builds[e].xDelta=xDistance),builds[e].yDelta>=yDistance&&(builds[e].yDelta=yDistance),builds[e].x>xFinal)a=builds[e].x-builds[e].xDelta-Game.camera.x;else var a=builds[e].x+builds[e].xDelta-Game.camera.x;if(builds[e].y>yFinal)i=builds[e].y-builds[e].yDelta-Game.camera.y;else var i=builds[e].y+builds[e].yDelta-Game.camera.y;Game.ctx.drawImage(Loader.getImage("ball"),0,0,map.tsize,map.tsize,a,i,map.tsize,map.tsize),builds[e].xDelta++,builds[e].yDelta++}else builds[e].xDelta=0,builds[e].yDelta=0,monsters[t].life=monsters[t].life-builds[e].caracteristique.attaque,builds[e].cible=0,builds[e].cibleMouvante=0})}),Game.anim>=DUREE_ANIMATION&&(Game.anim=0)},Game._drawGrid=function(){for(var e,t,a=map.cols*map.tsize,i=map.rows*map.tsize,s=0;s<map.rows;s++)e=-this.camera.x,t=s*map.tsize-this.camera.y,this.ctx.beginPath(),this.ctx.moveTo(e,t),this.ctx.lineTo(a,t),this.ctx.stroke();for(var o=0;o<map.cols;o++)e=o*map.tsize-this.camera.x,t=-this.camera.y,this.ctx.beginPath(),this.ctx.moveTo(e,t),this.ctx.lineTo(e,i),this.ctx.stroke();this.ctx.drawImage(this.hero.image,this.hero.screenX-this.hero.width/2,this.hero.screenY-this.hero.height/2),this.hero.life<=0&&(this.ctx.font="50px Arial",this.ctx.fillText("VOUS AVEZ PERDU !",0,this.hero.screenY))},Game._drawRectangle=function(e,t,a,i){this.ctx.fillStyle=e,this.ctx.fillRect(t,a,i,10)},Game.render=function(){this._drawLayer(0),this._drawLayer(1),Object.keys(monsters).forEach(function(e){monsters[e].life>0?(Game.ctx.drawImage(monsters[e].image,0,0,map.tsize,map.tsize,monsters[e].x-Game.camera.x,monsters[e].y-Game.camera.y,map.tsize,map.tsize),Game.ctx.fillStyle="#FF0000",Game.ctx.fillRect(2+monsters[e].x-Game.camera.x,monsters[e].y+70-Game.camera.y,monsters[e].life,10)):(Game.hero.xp=5*monsters[e].level,document.getElementById("xp_value").innerHTML=Game.hero.xp,anim=new animation(map,monsters[e].x,monsters[e].y,"xp"),delete monsters[e])}),this.ctx.fillStyle="#FF0000",this.ctx.fillRect(this.hero.screenX-30,this.hero.screenY+40,this.hero.life,10),this._drawGrid()};